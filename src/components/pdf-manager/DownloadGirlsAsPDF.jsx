import React, { useState } from "react";
import { methods } from "../../constants/methods";
import { LoadingButton } from "@mui/lab";
import { Download } from "@mui/icons-material";
import jsPDF from "jspdf";
import "jspdf-autotable";

function DownloadGirlsAsPDF({ district, upozilla }) {
  // fetch all reports
  const [dlLoading, setDlLoading] = useState(false);
  const downloadGirlsAsPDF = async () => {
    setDlLoading(true);
    const url = new URL(import.meta.env.VITE_API_BASE_URL + "girls");
    url.searchParams.append("district", district);
    url.searchParams.append("strSubLocation", upozilla);
    await fetch(url, {
      method: methods.GET,
      headers: { "Content-Type": "application/json" },
    })
      .then((res) => res.json())
      .then((obj) => {
        // convert data & download as PDF
        exportPDF(obj);
      })
      .catch((err) => alert(err))
      .finally(() => setDlLoading(false));
  };

  // export PDF from jsPDF
  const exportPDF = (data) => {
    const unit = "pt";
    const size = "A4"; // Use A1, A2, A3 or A4
    const orientation = "portrait"; // portrait or landscape

    const doc = new jsPDF(orientation, unit, size);

    doc.setFontSize(12);

    const x = 40;
    const ty = 40;
    const ty1 = 50;
    const iy = 60;
    const y_offset = 250;
    const placeholder = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4QBWRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAAEsAAAAAQAAASwAAAAB/+0ALFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAQAAAgAEAP/hDIFodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0n77u/JyBpZD0nVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkJz8+Cjx4OnhtcG1ldGEgeG1sbnM6eD0nYWRvYmU6bnM6bWV0YS8nIHg6eG1wdGs9J0ltYWdlOjpFeGlmVG9vbCAxMC4xMCc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp0aWZmPSdodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyc+CiAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICA8dGlmZjpYUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpYUmVzb2x1dGlvbj4KICA8dGlmZjpZUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpZUmVzb2x1dGlvbj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wTU09J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8nPgogIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnN0b2NrOmY3NTYxODZmLWJjODYtNDA0MC04ZjViLTcyMWI0ODE2ZmU3ZDwveG1wTU06RG9jdW1lbnRJRD4KICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjBmY2UzMDUzLWRjZGEtNDcyNi1hYTg1LTQwNWI4MWNlYTA4MjwveG1wTU06SW5zdGFuY2VJRD4KIDwvcmRmOkRlc2NyaXB0aW9uPgo8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSd3Jz8+/9sAQwAFAwQEBAMFBAQEBQUFBgcMCAcHBwcPCwsJDBEPEhIRDxERExYcFxMUGhURERghGBodHR8fHxMXIiQiHiQcHh8e/9sAQwEFBQUHBgcOCAgOHhQRFB4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4e/8AAEQgBaAFoAwERAAIRAQMRAf/EABsAAQEBAAIDAAAAAAAAAAAAAAAGBwMFAQIE/8QAPBABAAEBAwkDCgUEAwEAAAAAAAECAwQRBQYWITFRcZPhEkFVExUyNVRhdIGkwgcUIrHRM4OR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OnndAfLlTOu2vVztLvYXWLDykdmqua+1OE7cNQJsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH//Z";

    data.map((item,idx) => {
      const mtext = `Name: ${item.strName}, Phone: ${item.strPhone}, District: ${item.strDistrict}, Upazilla: ${item.strSubLocation}`;
      doc.text(mtext, x, ty + idx*y_offset);
      doc.text(" ", x, ty1 + idx*y_offset);
      doc.addImage(item.strImage?item.strImage:placeholder, 'JPEG', x, iy + idx*y_offset, 180, 180);
    });

    // const body = data.map((item) => [
    //   item.strName,
    //   item.strPhone,
    //   item.strDistrict,
    //   item.strSubLocation,
    // ]);

    // const content = {
    //   startY: 50,
    //   head: headers,
    //   body: body,
    // };

    // const x_pos = 40;
    // const y_pos = 40;
    // const y_offset = 210;
    // doc.text(data[0].strName, x_pos+10, y_pos);
    // doc.addImage(data[0].strImage, 'JPEG', x_pos, y_pos, 180, 180);
    // doc.text(data[7].strName, x_pos+10, y_pos + 1*y_offset);
    // doc.addImage(data[7].strImage, 'JPEG', x_pos, y_pos + 1*y_offset, 180, 180);
    // doc.autoTable(content);
    doc.save("girlslist.pdf");
  };

  return (
    <LoadingButton
      loading={dlLoading}
      loadingPosition="start"
      startIcon={<Download />}
      onClick={downloadGirlsAsPDF}
      variant="contained"
      sx={{
        fontFamily: "Poppins",
        textTransform: "none",
      }}
    >
      <span>Download</span>
    </LoadingButton>
  );
}

export default DownloadGirlsAsPDF;
